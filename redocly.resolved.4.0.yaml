openapi: 3.0.3
info:
  version: '4.0'
  title: Self Assessment Accounts (MTD)
  description: |
    The following group of endpoints is stateful in the Sandbox:
    * <a href="#tag/Coding-Out-Underpayments-and-Debts">Coding Out Underpayments and Debts</a>
    * <a href="#tag/Coding-Out-Status">Coding Out Status</a>

    # Send fraud prevention data
    HMRC monitors transactions to help protect your customers' confidential data from criminals and fraudsters. 

    <div class="govuk-warning-text warning-icon-fix">
      <span class="govuk-warning-text__icon warning-icon-ui-fix" aria-hidden="true">!</span>
      <strong class="govuk-warning-text__text">
        <span class="govuk-warning-text__assistive">Warning</span>
        You are required by law to submit header data for this API. This includes all associated APIs and endpoints.
      </strong>
    </div>

    [Check the data you need to send](/guides/fraud-prevention/). You can also use the [Test API](/api-documentation/docs/api/service/txm-fph-validator-api/1.0) during initial development and as part of your quality assurance checks.

    # Mapping APIs to Self Assessment tax return forms
    Some parameters in this API map to box numbers in one or more Self Assessment tax return forms. To learn more and to download this mapping information as a CSV file, go to [income-tax-mtd-changelog/mapping](https://github.com/hmrc/income-tax-mtd-changelog?tab=readme-ov-file#mapping-apis-to-self-assessment-tax-return-forms) on GitHub.

    # Changelog
    You can find the changelog in the [income-tax-mtd-changelog](https://github.com/hmrc/income-tax-mtd-changelog/#readme) on GitHub.

    # Support
    * Direct reports of bugs or errors in Production or Sandbox code, or queries about HMRC business functionality (such as how a specific field is used by HMRC or why it is needed) to the [Software Development Support Team (SDST)](https://developer.service.hmrc.gov.uk/developer/support).
    * Send queries or feedback related to the design of the APIs (including recommended changes) using the [income-tax-mtd-changelog](https://github.com/hmrc/income-tax-mtd-changelog/issues) GitHub page.
    * <a href="/contact/report-technical-problem?newTab=true&service=api-documentation-frontend" target="_blank">Is this page not working properly? (opens in new tab)</a>
servers:
  - url: https://test-api.service.hmrc.gov.uk
    description: Sandbox
  - url: https://api.service.hmrc.gov.uk
    description: Production
tags:
  - name: Payments and Liabilities
    description: These endpoints allow a developer to retrieve accounting information to be shown back to the customer. This includes listing payments the customer has made, how these payments have been allocated and details of any upcoming or outstanding liabilities. The data returned only relates to payments and liabilities arising for tax years since the customer joined the new service. There may also be outstanding liabilities and payment information a customer needs to view for the years prior to signing up to Making Tax Digital for Income Tax Self Assessment that can be viewed using their existing Personal Tax Account.<br><br>
  - name: Coding Out Underpayments and Debts
    description: Coding out is a concept used to retrieve underpaid tax and debts through a taxpayers PAYE tax code.<br><br> The coding out underpayments and debts endpoints allow software packages to overwrite coding out underpayment and debt amounts that are held by HMRC for a previous tax year and given NINO. Software packages can then amend previously submitted overwrite amounts, retrieve the HMRC held or user submitted coding out amounts or delete the user submitted amounts.<br><br>
  - name: Coding Out Status
paths:
  /accounts/self-assessment/{nino}/charges/{transactionId}:
    get:
      summary: Retrieve History of a Self Assessment Charge
      description: |
        This endpoint enables you to retrieve the history of changes to an individual charge. A National Insurance number and transaction ID must be provided. 
        You can get the transaction ID using the Retrieve Self Assessment Balance and Transactions endpoint - it is returned as documentId in the documentDetails array.
            
        ### Test data
        Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

        | Header Value (Gov-Test-Scenario) | Scenario                                       |
        |----------------------------------|------------------------------------------------|
        | N/A - DEFAULT                    | Simulates success response.                    |
        | NOT_FOUND                        | Simulates the scenario where no data is found. |   
      tags:
        - Payments and Liabilities
      security:
        - User-Restricted:
            - read:self-assessment
      parameters:
        - name: nino
          in: path
          description: |
            National Insurance number, in the format `AA999999A`.
          schema: &ref_6
            type: string
            example: TC663795B
          required: true
        - name: transactionId
          in: path
          description: |
            A unique identifier for this item. 

            Must conform to the regular expression
            ^[0-9A-Za-z]{1,12}$
          schema: &ref_7
            type: string
            example: X92AM39DLE3D
          required: true
        - name: Accept
          in: header
          description: |
            Specifies the response format and the version of the API to be used.
          schema: &ref_8
            type: string
            enum:
              - application/vnd.hmrc.4.0+json
          required: true
        - name: Authorization
          in: header
          description: |
            An OAuth 2.0 Bearer Token with the *read:self-assessment* scope.
          schema: &ref_9
            type: string
            example: Bearer bb7fed3fe10dd235a2ccda3d50fb
          required: true
        - name: Gov-Test-Scenario
          in: header
          description: |
            Only in sandbox environment. See Test Data table for all header values.
          schema: &ref_10
            type: string
            example: '-'
          required: false
      responses:
        '200':
          description: Success
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: &ref_0
                type: string
                example: c75f40a6-a3df-4429-a697-471eeec46435
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: &ref_1
                type: string
                example: Sun, 01 Jan 2023 23:59:59 GMT
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: &ref_2
                type: string
                example: Sun, 02 Jul 2023 23:59:59 GMT
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: &ref_3
                type: string
                example: https://developer.service.hmrc.gov.uk/api-documentation/docs/api/service/self-assessment-accounts-api
              required: false
          content:
            application/json:
              schema:
                $schema: http://json-schema.org/draft-04/schema#
                title: Retrieve History of a Self Assessment Charge
                description: This endpoint enables you to retrieve the history of changes to a single charge made by HMRC. A National Insurance number and transaction ID must be provided.
                type: object
                properties: &ref_11
                  chargeHistoryDetails:
                    description: A list of changes to a particular charge
                    type: array
                    items:
                      title: changeDetails
                      type: object
                      properties:
                        taxYear:
                          description: 'The tax year that this charge relates to in the format: YYYY-YY.'
                          type: string
                          example: 2022-23
                        transactionId:
                          description: A unique identifier used to return a single charge. Must conform to the regular expression ^[A-Za-z0-9]{1,12}$
                          type: string
                          example: X123456790A
                        transactionDate:
                          description: 'The date the charge was created in the format: YYYY-MM-DD.'
                          type: string
                          example: '2018-04-05'
                        description:
                          description: Primary method to identify what type of charge has been called.
                          type: string
                          example: POA1, Balancing charge
                        totalAmount:
                          description: The value of the charge following the change. The value must be between -99999999999.99 and 99999999999.99 up to 2 decimal places.
                          type: number
                          multipleOf: 0.01
                          minimum: -99999999999.99
                          maximum: 99999999999.99
                          example: '600.00'
                        changeDate:
                          description: 'The date the charge was changed, in the format: YYYY-MM-DD. This field is deprecated and will be removed in a future release. Use changeTimestamp instead.'
                          type: string
                          format: date
                          example: '2018-04-05'
                          deprecated: true
                        changeTimestamp:
                          description: 'The timestamp the charge was changed, in the format: YYYY-MM-DDThh:mm:ss.SSSZ'
                          type: string
                          format: date-time
                          example: '2018-04-05T14:15:22.802Z'
                        changeReason:
                          description: The reason for the change.
                          type: string
                          example: ' Amended return, Customer Request'
                        poaAdjustmentReason:
                          description: |-
                            A numeric code indicating the reason for adjustment to Payments on Account. 

                            The possible values (with their meanings) are:

                            001: Profits for the business are down/the business has ceased

                            002: Other income has gone down

                            003: Tax Allowances and reliefs have gone up

                            004: Tax deducted at source is more than previous year

                            005: Increasing the PoA after a prior adjustment

                            For example: 004
                          type: string
                          example: '004'
                      required:
                        - transactionId
                        - transactionDate
                        - description
                        - totalAmount
                        - changeTimestamp
                        - changeDate
                        - changeReason
                required: &ref_12
                  - chargeHistoryDetails
              examples:
                Request:
                  value:
                    chargeHistoryDetails: &ref_13
                      - taxYear: 2022-23
                        transactionId: X123456790A
                        transactionDate: '2018-04-05'
                        description: POA1, Balancing charge
                        totalAmount: 600
                        changeDate: '2018-04-05'
                        changeTimestamp: '2018-04-05T14:15:22.802Z'
                        changeReason: Amended return, Customer Request
                        poaAdjustmentReason: '004'
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: &ref_4
                  code:
                    description: The error code
                    type: string
                  message:
                    description: The error message
                    type: string
                required: &ref_5
                  - code
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied nino value is invalid.
                  value: &ref_14
                    code: FORMAT_NINO
                    message: The format of the supplied nino value is invalid.
                FORMAT_TRANSACTION_ID:
                  description: |
                    The format of the supplied transaction identifier field is not valid.
                  value: &ref_15
                    code: FORMAT_TRANSACTION_ID
                    message: The format of the supplied transaction identifier field is not valid0
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for 
                    this endpoint version. This error will only be returned in the Sandbox environment.
                  value: &ref_16
                    code: RULE_INCORRECT_GOV_TEST_SCENARIO
                    message: The supplied Gov-Test-Scenario is not valid
        '403':
          description: Forbidden
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    'The client or agent is not authorised. This is because: the client is not enrolled for MTD, the agent is not enrolled for Agent Services, the client has not authorised the agent to act on their behalf, or the Authorization token provided is not correct.'
                  value: &ref_17
                    code: CLIENT_OR_AGENT_NOT_AUTHORISED
                    message: 'The client or agent is not authorised. This is because: the client is not enrolled for MTD, the agent is not enrolled for Agent Services, the client has not authorised the agent to act on their behalf, or the Authorization token provided is not correct.'
        '404':
          description: Not found
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                NOT_FOUND:
                  description: |
                    Matching resource not found.
                  value: &ref_18
                    code: MATCHING_RESOURCE_NOT_FOUND
                    message: Matching resource not found
  /accounts/self-assessment/{nino}/charges/transactionId/{transactionId}:
    get:
      summary: Retrieve History of a Self Assessment Charge by Transaction ID
      description: |
        This endpoint enables you to retrieve the history of a Self Assessment charge made by HMRC using a transaction ID. A National Insurance number and transaction ID must be provided.

        ### Test data
        Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

        | Header Value (Gov-Test-Scenario) | Scenario                                       |
        |----------------------------------|------------------------------------------------|
        | N/A - DEFAULT                    | Simulates success response.                    |
        | NOT_FOUND                        | Simulates the scenario where no data is found. |   
      tags:
        - Payments and Liabilities
      security:
        - User-Restricted:
            - read:self-assessment
      parameters:
        - name: nino
          in: path
          description: |
            National Insurance number, in the format `AA999999A`.
          schema: *ref_6
          required: true
        - name: transactionId
          in: path
          description: |
            A unique identifier for this item. 

            Must conform to the regular expression
            ^[0-9A-Za-z]{1,12}$
          schema: *ref_7
          required: true
        - name: Accept
          in: header
          description: |
            Specifies the response format and the version of the API to be used.
          schema: *ref_8
          required: true
        - name: Authorization
          in: header
          description: |
            An OAuth 2.0 Bearer Token with the *read:self-assessment* scope.
          schema: *ref_9
          required: true
        - name: Gov-Test-Scenario
          in: header
          description: |
            Only in sandbox environment. See Test Data table for all header values.
          schema: *ref_10
          required: false
      responses:
        '200':
          description: Success
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                $schema: http://json-schema.org/draft-04/schema#
                title: Retrieve History of a Self Assessment Charge
                description: This endpoint enables you to retrieve the history of changes to a single charge made by HMRC. A National Insurance number and transaction ID must be provided.
                type: object
                properties: *ref_11
                required: *ref_12
              examples:
                Request:
                  value:
                    chargeHistoryDetails: *ref_13
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied nino value is invalid.
                  value: *ref_14
                FORMAT_TRANSACTION_ID:
                  description: |
                    The format of the supplied transaction identifier field is not valid.
                  value: *ref_15
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for 
                    this endpoint version. This error will only be returned in the Sandbox environment.
                  value: *ref_16
        '403':
          description: Forbidden
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    'The client or agent is not authorised. This is because: the client is not enrolled for MTD, the agent is not enrolled for Agent Services, the client has not authorised the agent to act on their behalf, or the Authorization token provided is not correct.'
                  value: *ref_17
        '404':
          description: Not found
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                NOT_FOUND:
                  description: |
                    Matching resource not found.
                  value: *ref_18
  /accounts/self-assessment/{nino}/charges/chargeReference/{chargeReference}:
    get:
      summary: Retrieve History of a Self Assessment Charge by Charge Reference
      description: |
        This endpoint enables you to retrieve the history of a Self Assessment charge made by HMRC using a charge reference number. A National Insurance number and charge reference number must be provided.

        ### Test data
        Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

        | Header Value (Gov-Test-Scenario) | Scenario                                       |
        |----------------------------------|------------------------------------------------|
        | N/A - DEFAULT                    | Simulates success response.                    |
        | NOT_FOUND                        | Simulates the scenario where no data is found. |   
      tags:
        - Payments and Liabilities
      security:
        - User-Restricted:
            - read:self-assessment
      parameters:
        - name: nino
          in: path
          description: |
            National Insurance number, in the format `AA999999A`.
          schema: *ref_6
          required: true
        - name: chargeReference
          in: path
          description: |
            This field will be used when the need is to view a specific document with help of Charge Reference number 

            Must conform to the regular expression
            ^[A-Za-z]{2}[0-9]{12}$
          schema:
            type: string
            example: Ck106547829351
          required: true
        - name: Accept
          in: header
          description: |
            Specifies the response format and the version of the API to be used.
          schema: *ref_8
          required: true
        - name: Authorization
          in: header
          description: |
            An OAuth 2.0 Bearer Token with the *read:self-assessment* scope.
          schema: *ref_9
          required: true
        - name: Gov-Test-Scenario
          in: header
          description: |
            Only in sandbox environment. See Test Data table for all header values.
          schema: *ref_10
          required: false
      responses:
        '200':
          description: Success
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                $schema: http://json-schema.org/draft-04/schema#
                title: Retrieve History of a Self Assessment Charge
                description: This endpoint enables you to retrieve the history of changes to a single charge made by HMRC. A National Insurance number and transaction ID must be provided.
                type: object
                properties: *ref_11
                required: *ref_12
              examples:
                Request:
                  value:
                    chargeHistoryDetails: *ref_13
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied nino value is invalid.
                  value: *ref_14
                FORMAT_CHARGE_REFERENCE:
                  description: |
                    The format of the supplied charge reference is not valid.
                  value:
                    code: FORMAT_CHARGE_REFERENCE
                    message: The provided charge reference is invalid
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for 
                    this endpoint version. This error will only be returned in the Sandbox environment.
                  value: *ref_16
        '403':
          description: Forbidden
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    'The client or agent is not authorised. This is because: the client is not enrolled for MTD, the agent is not enrolled for Agent Services, the client has not authorised the agent to act on their behalf, or the Authorization token provided is not correct.'
                  value: *ref_17
        '404':
          description: Not found
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                NOT_FOUND:
                  description: |
                    Matching resource not found.
                  value: *ref_18
  /accounts/self-assessment/{nino}/balance-and-transactions:
    get:
      summary: Retrieve Self Assessment Balance and Transactions
      description: |
        This endpoint enables you to retrieve the overall liability broken down into overdue, currently due (payable), and pending (not yet due) amounts. A National Insurance number must be provided.

        ### Test data
        Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

        | Header Value (Gov-Test-Scenario) | Scenario                                                            |
        |----------------------------------|---------------------------------------------------------------------|
        | N/A - DEFAULT                    | Simulates success response.                                         |
        | NOT_FOUND                        | Simulates the scenario where no data is found.                      |
      tags:
        - Payments and Liabilities
      security:
        - User-Restricted:
            - read:self-assessment
      parameters:
        - name: nino
          in: path
          description: |
            National Insurance number, in the format `AA999999A`.
          schema: *ref_6
          required: true
        - name: docNumber
          in: query
          description: |
            The docNumber is a unique number per tax grouping in the Account display.
            (When onlyOpenItems has been set to false, either the date range (fromDate and toDate) or doc number should be supplied.)
          schema:
            type: string
            example: '3060013199'
          required: false
        - name: fromDate
          in: query
          description: The inclusive start date of the period to filter payments. The maximum date range between fromDate and toDate should not exceed 732 days.
          schema: &ref_19
            type: string
            example: '2019-01-02'
          required: false
        - name: toDate
          in: query
          description: The inclusive end date of the period to filter payments. The maximum date range between fromDate and toDate should not exceed 732 days.
          schema: &ref_20
            type: string
            example: '2019-01-02'
          required: false
        - name: onlyOpenItems
          in: query
          description: |
            Limits the extraction to unpaid or not reversed charges.

            (When onlyOpenItems has been set to false, either the date range (fromDate and toDate) or docNumber should be supplied.)

            Defaults to false
          schema:
            type: boolean
            example: false
          required: false
        - name: includeLocks
          in: query
          description: |
            Include additional information related to claim and debt management.

            Defaults to false
          schema:
            type: boolean
            example: true
          required: false
        - name: calculateAccruedInterest
          in: query
          description: |
            Calculate accrued interest. Accruing interest is the amount of interest calculated

            a) To todayâ€™s date (or in the case of a created statement, to the statement date)

            b) On any overdue interest-bearing liability

            No interest charge is created for an amount of accruing interest. An interest charge is only created when the related liability is paid in full.
          schema:
            type: boolean
            example: false
          required: false
        - name: removePOA
          in: query
          description: |
            Remove Payment on Account details. When true, details of any payments that the customer has made will not be returned.

            Defaults to false.
          schema:
            type: boolean
            example: false
          required: false
        - name: customerPaymentInformation
          in: query
          description: |
            Include customer payment information in the response. When true, the following information is returned:
            Payment Reference, Payment Amount, Payment Method, Payment Lot, Payment Lot Item, Clearing SAP Document.

            Note that if removePOA is true, no information is returned even if customerPaymentInformation is true.

            Defaults to false.
          schema:
            type: boolean
            example: false
          required: false
        - name: includeEstimatedCharges
          in: query
          description: |
            Include statistical (estimated) values for monthly payments.

            Defaults to false.
          schema:
            type: boolean
            example: true
          required: false
        - name: Accept
          in: header
          description: |
            Specifies the response format and the version of the API to be used.
          schema: *ref_8
          required: true
        - name: Authorization
          in: header
          description: |
            An OAuth 2.0 Bearer Token with the *read:self-assessment* scope.
          schema: *ref_9
          required: true
        - name: Gov-Test-Scenario
          in: header
          description: |
            Only in sandbox environment. See Test Data table for all header values.
          schema: *ref_10
          required: false
      responses:
        '200':
          description: Success
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                $schema: http://json-schema.org/draft-04/schema#
                title: Retrieve Self Assessment Balance and Transactions
                description: This endpoint enables you to retrieve the overall liability broken down into overdue, currently due (payable), and pending (not yet due) amounts. A National Insurance number must be provided.
                type: object
                properties:
                  balanceDetails:
                    $schema: http://json-schema.org/draft-04/schema#
                    type: object
                    properties:
                      payableAmount:
                        description: The sum of any non-zero charges whose payment due date is within 30 days. The value must be between -99999999999.99 and 99999999999.99 to 2 decimal places.
                        type: number
                        example: '5009.99'
                      payableDueDate:
                        description: Next payment date for charges due in the format YYYY-MM-DD.
                        type: string
                        example: '2018-04-05'
                      pendingChargeDueAmount:
                        description: The sum of any charges whose payment is pending (not yet due). The value must be between -99999999999.99 and 99999999999.99 to 2 decimal places.
                        type: number
                        example: '5009.99'
                      pendingChargeDueDate:
                        description: The date by when the next pending (not yet due) charge must be paid in the format YYYY-MM-DD.
                        type: string
                        example: '2018-04-05'
                      overdueAmount:
                        description: "The total amount of charges under each documentID whose due date is in the past Accrued Interest Amount / LPI Amount will also be included (where applicable). \r\n The value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                        type: number
                        example: '5009.99'
                      bcdBalancePerYear:
                        description: An array containing balance charge debit payment details.
                        type: array
                        items:
                          type: object
                          properties:
                            taxYear:
                              description: The tax year for the appropriate balance charge debit.
                              type: string
                              example: 2018-19
                            bcdAmount:
                              description: "The balancing charge debit amount is the balancing payment due by the taxpayer calculated when the return is captured.\r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                              type: number
                              example: '5009.99'
                          required:
                            - bcdAmount
                            - taxYear
                      earliestPaymentDateOverdue:
                        description: The next day after the payment due date in the format YYYY-MM-DD
                        type: string
                        example: '2018-04-05'
                      totalBalance:
                        description: "The sum of all the unpaid charges excluding statistical and  EOY coded out. The total balance should be equal to the sum of the balance due within 30 days, balance not due in 30 days, and overdue amount.\r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                        type: number
                        example: '5009.99'
                      amountCodedOut:
                        description: "The total amount of underpayment codeout.\r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                        type: number
                        example: '5009.99'
                      totalBcdBalance:
                        description: "The total of the Balance charge debit balance amount.\r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places"
                        type: number
                        example: '5009.99'
                      unallocatedCredit:
                        description: "Sum of all the Open credit Items on the customer's account, posted for Income tax Self-assessment.\r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                        type: number
                        example: '5009.99'
                      allocatedCredit:
                        description: "Sum of all the closed credit items on the customer's account, posted for  Income tax Self-assessment.\r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                        type: number
                        example: '5009.99'
                      totalCredit:
                        description: "Sum of unallocated credit + allocated credit.\r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                        type: number
                        example: '5009.99'
                      firstPendingAmountRequested:
                        description: "This will be the first pending amount that is requested.\r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                        type: number
                        example: '5009.99'
                      secondPendingAmountRequested:
                        description: "This will be the second pending amount that is requested.\r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                        type: number
                        example: '5009.99'
                      availableCredit:
                        description: "This will be equal to total credit minus the pending amount(s) requested.\r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                        type: number
                        example: '5009.99'
                    required:
                      - payableAmount
                      - bcdBalancePerYear
                      - pendingChargeDueAmount
                      - overdueAmount
                      - totalBalance
                  codingDetails:
                    $schema: http://json-schema.org/draft-04/schema#
                    title: Retrieve coding details
                    description: An Object containing coding details
                    type: array
                    items:
                      type: object
                      properties:
                        returnTaxYear:
                          description: The ending year of the tax year to which the return relates is in the format YYYY-YY.
                          type: string
                          example: 2021-22
                        totalLiabilityAmount:
                          description: The total amount of the Self Assessment tax return inclusive of coded charges. The value must be between -99999999999.99 and 99999999999.99 up to 2 decimal places.
                          type: number
                          multipleOf: 0.01
                          minimum: -99999999999.99
                          maximum: 99999999999.99
                          example: '5009.99'
                        codingTaxYear:
                          description: The tax year that the coded out charge will be attached to.
                          type: string
                          example: 2021-22
                        coded:
                          description: An object containing a coded amount and initiation date
                          type: object
                          properties:
                            charge:
                              description: The coded out charge. The value must be between -99999999999.99 and 99999999999.99 up to 2 decimal places.
                              type: number
                              multipleOf: 0.01
                              minimum: -99999999999.99
                              maximum: 99999999999.99
                              example: '5009.99'
                            initiationDate:
                              description: Initiation date of the coded out charge, in the format YYYY-MM-DD.
                              type: string
                              example: '2021-04-05'
                  documentDetails:
                    $schema: http://json-schema.org/draft-04/schema#
                    type: array
                    description: An array containing document details
                    items:
                      type: object
                      description: An object containing document details
                      properties:
                        taxYear:
                          description: The tax year of the Document (Billing period from â€“ billing period to), in the format YYYY-YY. For example, the tax year 2020 to 2021 is expressed as 2020-21.
                          type: string
                          example: 2020-21
                        documentId:
                          description: DocumentID may contain SAP document number or Form Bundle Number for zero-amount documents. Must conform to the regular expression ^[0-9a-zA-Z]{1,12}$
                          type: string
                          example: '1455'
                        formBundleNumber:
                          description: 'The form bundle number designates a package of related transactions gathered together. '
                          type: string
                          example: '88888888'
                        creditReason:
                          description: Credit Reason gives the reason as to why there is a credit on the account.
                          type: string
                          example: Voluntary Payment
                          enum:
                            - Voluntary Payment
                            - Income tax Self Assessment Return
                            - Excess Payment
                        documentDate:
                          description: The date when the document for a particular tax group containing charges was created in the format YYYY-MM-DD.
                          type: string
                          example: '2018-04-05'
                        documentText:
                          description: Provides details about the tax group that the charge belongs to.
                          type: string
                          example: ITSA- Bal Charge
                        documentDueDate:
                          description: The date the item must be received in the format YYYY-MM-DD.
                          type: string
                          example: '2021-04-05'
                        documentDescription:
                          description: The primary method to identify what type of document has been called.
                          type: string
                          example: ITSA- POA 1
                          enum:
                            - ITSA- POA 1
                            - ITSA - POA 2
                            - ITSA- Bal Charge
                            - New Charge
                            - Clearing Document
                            - TRM New Charge
                            - TRM Amend Charge
                            - Payment
                            - Repayment
                        originalAmount:
                          description: "The original value of this transaction before payments, credits, or adjustments.\r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                          type: number
                          multipleOf: 0.01
                          minimum: -99999999999.99
                          maximum: 99999999999.99
                          example: '5000.99'
                        outstandingAmount:
                          description: "The amount remaining of this transaction after payments, credits, or adjustments.\r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                          type: number
                          multipleOf: 0.01
                          minimum: -99999999999.99
                          maximum: 99999999999.99
                          example: '5000.99'
                        lastClearing:
                          description: Details if the amount was previously modified.
                          type: object
                          properties:
                            lastClearingDate:
                              description: The date the outstanding amount was last modified, in the format YYYY-MM-DD.
                              type: string
                              example: '2018-04-05'
                            lastClearingReason:
                              description: The reason for the change. For example, an interest charge was created.
                              type: string
                              example: Incoming Payment
                              enum:
                                - Incoming Payment
                                - Outgoing Payment
                                - Other
                                - Write-Off
                                - Reversal
                            lastClearedAmount:
                              description: The amount the transaction was last modified by. The value must be between -99999999999.99 and 99999999999.99 to 2 decimal places.
                              type: number
                              multipleOf: 0.01
                              minimum: -99999999999.99
                              maximum: 99999999999.99
                              example: '5000.99'
                        isChargeEstimate:
                          description: An indicator to represent that the charge is an estimate and not an actual charge. The value must be true or false.
                          type: boolean
                          example: 'false'
                        isCodedOut:
                          description: An indicator to represent that the charge has been sent for coding out.
                          type: boolean
                          example: 'false'
                        paymentLot:
                          description: A unique identifier for a credit that has been made direct to ETMP.
                          type: string
                          example: AB1023456789
                        paymentLotItem:
                          description: A unique ID that is used in combination with Payment Lot to refer to an individual payment.
                          type: string
                          example: '000001'
                        effectiveDateOfPayment:
                          description: The effective date of payment in the format YYYY-MM-DD.
                          type: string
                          example: '2021-04-05'
                        latePaymentInterest:
                          description: An object containing late payment interest details.
                          type: object
                          properties:
                            latePaymentInterestId:
                              description: Late Payment Interest ID is the Charge Reference Number of all the monthly and final interest charges of the same parent charge.
                              type: string
                              example: '1234567890123456'
                            accruingInterestAmount:
                              description: "The total value of all the monthly interest charges and accruing (unposted) interest charges is grouped by Charge Reference level. \r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places.\r\n"
                              type: number
                              multipleOf: 0.01
                              minimum: -99999999999.99
                              maximum: 99999999999.99
                              example: '5000.99'
                            interestRate:
                              description: The latest interest rate for late payments. The value must be between 0 and 99.99 to 2 decimal places.
                              type: number
                              multipleOf: 0.01
                              minimum: 0
                              maximum: 99.99
                              example: '5.99'
                            interestStartDate:
                              description: The date the interest charges started in the format YYYY-MM-DD.
                              type: string
                              example: '2020-04-05'
                            interestEndDate:
                              description: The date the interest charges ended in the format YYYY-MM-DD.
                              type: string
                              example: '2020-05-05'
                            interestAmount:
                              description: "The total value of all the monthly interest charges and final interest charges is grouped by Charge Reference level.\r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                              type: number
                              multipleOf: 0.01
                              minimum: -99999999999.99
                              maximum: 99999999999.99
                              example: '201.99'
                            interestDunningLockAmount:
                              description: "Late payment interest amount where the  Interest is temporarily not being charged on (A lock has been put so the interest will not be charged to the customer). \r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                              type: number
                              multipleOf: 0.01
                              minimum: -99999999999.99
                              maximum: 99999999999.99
                              example: '5009.99'
                            interestOutstandingAmount:
                              description: "TThe unpaid amount of Accruing Interest or Late Payment Interest. \r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                              type: number
                              multipleOf: 0.01
                              minimum: -99999999999.99
                              maximum: 99999999999.99
                              example: '5000.99'
                        amountCodedOut:
                          description: "The amount from the total tax return charge that has been coded out. \r\nThe value must be between -9999.99 and 2999.99 to 2 decimal places."
                          type: number
                          multipleOf: 0.01
                          minimum: -99999999999.99
                          maximum: 99999999999.99
                          example: '5009.99'
                        reducedCharge:
                          description: Details if Charge has been reduced.
                          type: object
                          properties:
                            chargeType:
                              description: "Document name of charge reduced. \r\nThis will be the Charge type name of the original charge"
                              type: string
                              example: AA
                            documentNumber:
                              description: "If Charge has been reduced, and credit arises, the document number to be shown. \r\nThis will be the SAP Document number of this document"
                              type: string
                              example: '1234567890123456'
                            amendmentDate:
                              description: "Amendment date of charge that has been reduced. \r\nThis will be the date the charge was reduced/changed/reversed in the format YYYY-MM-DD."
                              type: string
                              example: '2018-04-05'
                            taxYear:
                              description: "Tax Year of Charge that has been reduced. \r\nThis is the tax year on the original charge."
                              type: string
                              example: 2018-19
                        poaRelevantAmount:
                          description: "Payments on account relevant amount. \r\nThe value must be between -99999999999.99 and 99999999999.99 to 2 decimal places."
                          type: number
                          multipleOf: 0.01
                          minimum: -99999999999.99
                          maximum: 99999999999.99
                          example: '8999.98'
                      required:
                        - documentId
                        - documentDate
                        - originalAmount
                        - outstandingAmount
                        - isChargeEstimate
                        - isCodedOut
                  financialDetails:
                    $schema: http://json-schema.org/draft-04/schema#
                    type: array
                    items:
                      type: object
                      description: A list of charges that make up the overall transaction. The items may include subitems.
                      properties:
                        taxYear:
                          description: The tax year to which the charge relates, in the format YYYY-YY
                          type: string
                          example: 2020-21
                        chargeDetail:
                          type: object
                          properties:
                            documentId:
                              type: string
                              description: DocumentID may contain SAP document number or Form Bundle Number for zero-amount documents. Must conform to the regular expression ^[0-9a-zA-Z]{1,12}$
                              example: XAIS12345678910
                            documentType:
                              type: string
                              description: A unique ID is used to reference the document type of which this is a subitem.
                              example: '1234'
                            documentTypeDescription:
                              type: string
                              description: The Description of the main charge type
                              example: SA Balancing Charge
                            chargeType:
                              type: string
                              description: A unique ID is used to identify the type of sub-item.
                              example: '3175'
                            chargeTypeDescription:
                              type: string
                              description: |-
                                Name of charge type.
                                Must conform to the regular expression:
                                ^[0-9A-Za-z]{1,30}$
                              example: Income Tax Estimate - NIC2 NI
                          required:
                            - documentId
                        taxPeriodFrom:
                          type: string
                          description: |-
                            The 'from' date of this tax period.
                            Date in the format: YYYY-MM-DD
                          example: '2020-04-06'
                        taxPeriodTo:
                          type: string
                          description: |-
                            The 'to' date of this tax period.
                            Date in the format: YYYY-MM-DD
                          example: '2021-04-05'
                        contractAccount:
                          type: string
                          description: A contract account is the accounting record for a particular charge type.
                          example: X
                        documentNumber:
                          type: string
                          description: |-
                            Same as Document Number/ID unless on output there is no postings (zero amounts) then the Form Bundle is returned 

                            Must conform to the regular expression: ^[0-9A-Za-z]{1,12}$
                          example: '1040000872'
                        documentNumberItem:
                          type: string
                          description: An identifier for this part of the overall transaction is used to link an allocation and charge.
                          example: XM00
                        chargeReference:
                          type: string
                          description: A unique reference number is associated with the charge.
                          example: XM002610011594
                        originalAmount:
                          type: number
                          description: |-
                            The original amount of this transaction.
                            The value must be between -99999999999.99 and 99999999999.99 to 2 decimal places.
                          example: '5009.99'
                        outstandingAmount:
                          type: number
                          description: |-
                            The remaining amount is due on this transaction.
                            The value must be between -99999999999.99 and 99999999999.99 to 2 decimal places.
                          example: '5009.99'
                        clearedAmount:
                          type: number
                          description: |-
                            The cleared value of this transaction. For example, the paid amount of a charge. 
                            The value must be between -99999999999.99 and 99999999999.99 to 2 decimal places.
                          example: '5009.99'
                        accruedInterest:
                          type: number
                          description: |-
                            The accrued interest of this transaction.
                            Accrued interest is interest calculated and charged.
                            The value must be between -99999999999.99 and 99999999999.99 to 2 decimal places
                          example: '5009.99'
                        items:
                          $schema: http://json-schema.org/draft-04/schema#
                          title: Retrieve History of a Self Assessment Charge
                          description: This endpoint enables you to retrieve the history of changes to a single charge made by HMRC. A National Insurance number and transaction ID must be provided.
                          type: array
                          items:
                            type: object
                            description: The list of items as part of the financial details
                            properties:
                              itemId:
                                description: An identifier for the item in the list.
                                type: string
                                example: '001'
                              dueDate:
                                description: If the requested item relates to a charge, the due date is the date by which the amount is due to be paid. If the requested item relates to a payment, the due date refers to the date the payment was made to HMRC in the format YYY-MM-DD
                                type: string
                                example: '2018-04-05'
                              amount:
                                description: The amount that this entry changed the transaction by. The value must be between -99999999999.99 and 99999999999.99 to 2 decimal places.
                                type: number
                                multipleOf: 0.01
                                minimum: -99999999999.99
                                maximum: 99999999999.99
                                example: '5009.99'
                              clearingDate:
                                description: The date this entry changed the item, in the format YYYY-MM-DD.
                                type: string
                                example: '2018-04-05'
                              clearingReason:
                                description: The reason for the change to the item.
                                type: string
                                example: Incoming Payment
                                enum:
                                  - Incoming Payment
                                  - Outgoing Payment
                                  - Reversal
                                  - Manual Clearing
                                  - Automatic Clearing
                              outgoingPaymentMethod:
                                description: The method used to make the outgoing payment. One of Repayment to Card, Payable Order Repayment or BACS Payment out
                                example: Payable Order Repayment
                                type: string
                                enum:
                                  - Repayment to Card
                                  - Payable Order Repayment
                                  - BACS Payment out
                              locks:
                                type: object
                                description: An object holding the lock fields
                                properties:
                                  isChargeOnHold:
                                    description: A signal that indicates that the charge has been paused whilst under review or investigation.
                                    type: boolean
                                    example: 'false'
                                  isEstimatedChargeOnHold:
                                    description: A clearing lock is used only for statistical or forecasted charges.
                                    type: boolean
                                    example: 'false'
                                  isInterestAccrualOnHold:
                                    description: Indicates if the charge is not accruing interest due to a review or investigation.
                                    type: boolean
                                    example: 'true'
                                  isInterestChargeOnHold:
                                    description: A lock has been put in so the interest will not be charged to the customer.
                                    type: boolean
                                    example: 'true'
                                required:
                                  - isChargeOnHold
                                  - isEstimatedChargeOnHold
                                  - isInterestAccrualOnHold
                                  - isInterestChargeOnHold
                              isReturn:
                                description: If it is true, that means the charge has been generated by a return.
                                type: boolean
                                example: 'true'
                              paymentReference:
                                description: A unique reference number is associated with the payment.
                                type: string
                                example: Ab12453535
                              paymentAmount:
                                description: |-
                                  If the item relates to a payment, the payment amount is the amount of the payment received into the account.

                                  If the item relates to a charge, the payment amount is the amount that this entry changed the transaction by. The value must be between -99999999999.99 and 99999999999.99 to 2 decimal places.
                                type: number
                                multipleOf: 0.01
                                minimum: -99999999999.99
                                maximum: 99999999999.99
                                example: '5009.99'
                              paymentMethod:
                                description: The method used to make the payment.
                                type: string
                                example: BACS RECEIPTS
                              paymentLot:
                                description: If the item is a payment, the payment lot is a unique identifier for a credit. If the item is a charge, the payment lot is a unique identifier for an allocation within the charge and allows you to identify where the payment came from.
                                type: string
                                example: '81203010024'
                              paymentLotItem:
                                description: A unique ID is used in combination with a payment ID to refer to an individual payment or credit.
                                type: string
                                example: '000001'
                              clearingSAPDocument:
                                description: When a payment is used against a charge, this links payment and charge together.
                                type: string
                                example: '3350000253'
                              isChargeEstimate:
                                description: Indicates whether the item represents an estimated charge.
                                type: boolean
                                example: 'true'
                              codedOutStatus:
                                description: Indicates whether an amount has been coded out through the PAYE system.
                                example: initiated
                                type: string
                                enum:
                                  - initiated
                                  - not-collected
                                  - partly-collected
                                  - fully-collected
                                  - awaiting-collection
                                  - waiting-cancellation
                                  - cancelled
                                  - rejected
                      required:
                        - taxYear
                        - chargeDetail
                        - items
                required:
                  - balanceDetails
                additionalProperties: false
              examples:
                Request:
                  value:
                    balanceDetails:
                      payableAmount: -99999999999.99
                      payableDueDate: '1920-02-29'
                      pendingChargeDueAmount: -99999999999.99
                      pendingChargeDueDate: '1920-02-29'
                      overdueAmount: -99999999999.99
                      bcdBalancePerYear:
                        - taxYear: 2022-23
                          bcdAmount: 1300.12
                        - taxYear: 2020-21
                          bcdAmount: 1600.12
                      earliestPaymentDateOverdue: '1920-02-29'
                      totalBalance: -99999999999.99
                      amountCodedOut: 3456.67
                      totalBcdBalance: 2600.24
                      unallocatedCredit: 3456.67
                      allocatedCredit: 2345.67
                      totalCredit: 4567.67
                      firstPendingAmountRequested: 1234.67
                      secondPendingAmountRequested: 3100.67
                      availableCredit: 1212.67
                    codingDetails:
                      - returnTaxYear: 2020-21
                        totalLiabilityAmount: 5009.99
                        codingTaxYear: 2020-21
                        coded:
                          charge: 5009.99
                          initiationDate: '2021-04-05'
                    documentDetails:
                      - taxYear: 2020-21
                        documentId: '1455'
                        formBundleNumber: '88888888'
                        creditReason: Voluntary Payment
                        documentDate: '2018-04-05'
                        documentText: ITSA- Bal Charge
                        documentDueDate: '2021-04-05'
                        documentDescription: ITSA- POA 1
                        originalAmount: 5009.99
                        outstandingAmount: 5009.99
                        lastClearing:
                          lastClearingDate: '2018-04-05'
                          lastClearingReason: Incoming Payment
                          lastClearedAmount: 5009.99
                        isChargeEstimate: true
                        isCodedOut: true
                        paymentLot: AB1023456789
                        paymentLotItem: '000001'
                        effectiveDateOfPayment: '2021-04-05'
                        latePaymentInterest:
                          latePaymentInterestId: '1234567890123456'
                          accruingInterestAmount: 5009.99
                          interestRate: 5.99
                          interestStartDate: '2020-04-01'
                          interestEndDate: '2020-04-05'
                          interestAmount: 5009.99
                          interestDunningLockAmount: 5009.99
                          interestOutstandingAmount: 5009.99
                        amountCodedOut: 5009.99
                        reducedCharge:
                          chargeType: AA
                          documentNumber: '1234567890123456'
                          amendmentDate: '2018-04-05'
                          taxYear: 2017-18
                        poaRelevantAmount: 8999.98
                    financialDetails:
                      - taxYear: 2016-17
                        chargeDetail:
                          documentId: '123456789012'
                          documentType: '1234'
                          documentTypeDescription: Income Tax Estimate
                          chargeType: '5678'
                          chargeTypeDescription: Income Tax Estimate - ITSA
                        taxPeriodFrom: '2018-08-13'
                        taxPeriodTo: '2018-08-14'
                        contractAccount: X
                        documentNumber: '1040000872'
                        documentNumberItem: XM00
                        chargeReference: XM002610011594
                        originalAmount: 10000
                        outstandingAmount: 10000
                        clearedAmount: 10000
                        accruedInterest: 10000
                        items:
                          - itemId: '001'
                            dueDate: '2018-08-13'
                            amount: 10000
                            clearingDate: '2018-08-13'
                            clearingReason: Outgoing Payment
                            outgoingPaymentMethod: Payable Order Repayment
                            locks:
                              isChargeOnHold: false
                              isEstimatedChargeOnHold: false
                              isInterestAccrualOnHold: false
                              isInterestChargeOnHold: false
                            isReturn: true
                            paymentReference: Ab12453535
                            paymentAmount: 10000
                            paymentMethod: Payment
                            paymentLot: '81203010024'
                            paymentLotItem: '000001'
                            clearingSAPDocument: '3350000253'
                            isChargeEstimate: true
                            codedOutStatus: initiated
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied nino value is invalid.
                  value: *ref_14
                FORMAT_DOC_NUMBER:
                  description: |
                    The format of docNumber is not valid.
                  value:
                    code: FORMAT_DOC_NUMBER
                    message: The format of docNumber is not valid.
                FORMAT_ONLY_OPEN_ITEMS:
                  description: |
                    The format of onlyOpenItem is not valid.
                  value:
                    code: FORMAT_ONLY_OPEN_ITEMS
                    message: The format of onlyOpenItem is not valid.
                FORMAT_INCLUDE_LOCKS:
                  description: |
                    The format of includeLocks is not valid.
                  value:
                    code: FORMAT_INCLUDE_LOCKS
                    message: The format of includeLocks is not valid.
                FORMAT_CALCULATE_ACCRUED_INTEREST:
                  description: |
                    The format for calculatingAccruedInterest is not valid.
                  value:
                    code: FORMAT_CALCULATE_ACCRUED_INTEREST
                    message: The format for calculatingAccruedInterest is not valid.
                FORMAT_CUSTOMER_PAYMENT_INFORMATION:
                  description: |
                    The format of customerPaymentInformation is not valid.
                  value:
                    code: FORMAT_CUSTOMER_PAYMENT_INFORMATION
                    message: The format of customerPaymentInformation is not valid.
                FORMAT_FROM_DATE:
                  description: |
                    The format of the fromDate is not valid.
                  value: &ref_21
                    code: FORMAT_FROM_DATE
                    message: The format of the fromDate is not valid.
                FORMAT_TO_DATE:
                  description: |
                    The format of toDate is not valid.
                  value: &ref_22
                    code: FORMAT_TO_DATE
                    message: The format of toDate is not valid.
                FORMAT_REMOVE_PAYMENT_ON_ACCOUNT:
                  description: |
                    The format of removePOA is not valid.
                  value:
                    code: FORMAT_REMOVE_PAYMENT_ON_ACCOUNT
                    message: The format of removePOA is not valid.
                FORMAT_INCLUDE_ESTIMATED_CHARGES:
                  description: |
                    The format of includeEstimatedCharges is not valid
                  value:
                    code: FORMAT_INCLUDE_ESTIMATED_CHARGES
                    message: The format of includeEstimatedCharges is not valid
                RULE_INVALID_DATE_RANGE:
                  description: |
                    The provided date range is not valid.
                  value: &ref_24
                    code: RULE_INVALID_DATE_RANGE
                    message: The provided date range is not valid.
                RULE_INCONSISTENT_QUERY_PARAMS:
                  description: |
                    Provide date range or docNumber when onlyOpenItems is false.
                  value:
                    code: RULE_INCONSISTENT_QUERY_PARAMS
                    message: Provide date range or docNumber when onlyOpenItems is false.
                MISSING_TO_DATE:
                  description: |
                    The To date parameter is missing.
                  value: &ref_25
                    code: MISSING_TO_DATE
                    message: The To date parameter is missing.
                MISSING_FROM_DATE:
                  description: |
                    The From date parameter is missing
                  value: &ref_26
                    code: MISSING_FROM_DATE
                    message: The From date parameter is missing
                RANGE_TO_DATE_BEFORE_FROM_DATE:
                  description: |
                    The To date must be after the From date.
                  value: &ref_23
                    code: RANGE_TO_DATE_BEFORE_FROM_DATE
                    message: The To date must be after the From date.
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for 
                    this endpoint version. This error will only be returned in the Sandbox environment.
                  value: *ref_16
        '403':
          description: Forbidden
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    'The client or agent is not authorised. This is because: the client is not enrolled for MTD, the agent is not enrolled for Agent Services, the client has not authorised the agent to act on their behalf, or the Authorization token provided is not correct.'
                  value: *ref_17
        '404':
          description: Not found
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                NOT_FOUND:
                  description: |
                    Matching resource not found.
                  value: *ref_18
  /accounts/self-assessment/{nino}/payments-and-allocations:
    get:
      summary: List Self Assessment Payments & Allocation Details
      description: |
        This endpoint enables you to list the payments and allocation details of one or more liabilities for a National insurance number.

        ### Test data
        Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

        | Header Value (Gov-Test-Scenario) | Scenario                                                         |
        |----------------------------------|------------------------------------------------------------------|
        | N/A - DEFAULT                    | Simulates success response.                                      |
        | NOT_FOUND                        | Simulates the scenario where no data is found.                   |
        | INVALID_DATE_RANGE               | Simulates the scenario where the provided date range is invalid. |    
      security:
        - User-Restricted:
            - read:self-assessment
      tags:
        - Payments and Liabilities
      parameters:
        - name: nino
          in: path
          description: |
            National Insurance number, in the format `AA999999A`.
          schema: *ref_6
          required: true
        - name: fromDate
          in: query
          description: The inclusive start date of the period to filter payments. The maximum date range between fromDate and toDate should not exceed 732 days.
          schema: *ref_19
          required: false
        - name: toDate
          in: query
          description: The inclusive end date of the period to filter payments. The maximum date range between fromDate and toDate should not exceed 732 days.
          schema: *ref_20
          required: false
        - name: paymentLot
          in: query
          description: An identifier for the batch process that processed the pagexyment and assigned it to the taxpayer's account.
          schema:
            type: string
            example: '081203010024'
          required: false
        - name: paymentLotItem
          in: query
          description: An identifier for each payment within a payment lot. paymentLot and paymentLotItem together uniquely identify a payment.
          schema:
            type: string
            example: '000001'
          required: false
        - name: Accept
          in: header
          description: |
            Specifies the response format and the version of the API to be used.
          schema: *ref_8
          required: true
        - name: Authorization
          in: header
          description: |
            An OAuth 2.0 Bearer Token with the *read:self-assessment* scope.
          schema: *ref_9
          required: true
        - name: Gov-Test-Scenario
          in: header
          description: |
            Only in sandbox environment. See Test Data table for all header values.
          schema: *ref_10
          required: false
      responses:
        '200':
          description: Success
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                type: object
                properties:
                  payments:
                    description: An array containing payments made by the customer.
                    type: array
                    items:
                      type: object
                      properties:
                        paymentLot:
                          type: string
                          description: An identifier for the batch process that processed the payment and assigned it to the taxpayer's account.
                          example: AB1023456789-000001
                        paymentLotItem:
                          type: string
                          description: An identifier for each payment within a payment lot. paymentLot and paymentLotItem together uniquely identify a payment.
                          example: '000001'
                        paymentReference:
                          type: string
                          description: A unique reference number associated with the payment.
                          example: '000001700000001'
                        paymentAmount:
                          type: number
                          description: |-
                            The amount of the payment received into the account. 

                            The value must be between -99999999999.99 and 99999999999.99 up to 2 decimal places.
                          example: '10000.00'
                        paymentMethod:
                          type: string
                          description: |-
                            The method used to make the payment. 

                            Must conform to the regular expression:
                            ^[0-9A-Za-z]{1,30}$
                          example: BACS, Payment by card
                        transactionDate:
                          type: string
                          description: 'The date the payment was received into the account in the format: YYYY-MM-DD'
                          example: '2018-04-05'
                        allocations:
                          type: array
                          description: A list of charges which are allocated amounts from the payment
                          items:
                            type: object
                            properties:
                              chargeReference:
                                type: string
                                description: A unique reference for the original charge that the payment was made against.
                                example: XM002610011595
                              periodKey:
                                type: string
                                description: |-
                                  The period key attributed to the charge.

                                  A four digit reference containing characters and numbers to identify the specific tax period.
                                example: 16RL
                              periodKeyDescription:
                                type: string
                                description: A description of the period key as a tax period.
                                example: 6th April 2020 to 5th April 2021
                              startDate:
                                type: string
                                description: The start date of the tax year for the charge in the format YYYY-MM-DD
                                example: '2018-04-06'
                              endDate:
                                type: string
                                description: The end date of the tax year for the charge in the format YYYY-MM-DD
                                example: '2019-04-05'
                              dueDate:
                                type: string
                                description: The date the charge must be paid by. Interest or penalties will be accrued after this date.
                                example: '2019-07-27'
                              chargeDetail:
                                type: object
                                properties:
                                  documentId:
                                    type: string
                                    description: 'Same as Document Number unless on output there are no postings then the Form Bundle number is returned. Must conform to the regular expression: ^[0-9A-Za-z]{1,12}$'
                                    example: '1040000872'
                                  documentType:
                                    type: string
                                    description: A code to specify the document type of which this is a subitem.
                                    example: '3880'
                                  documentTypeDescription:
                                    type: string
                                    description: Description of the document type.
                                    example: Income Tax Estimate
                                  chargeType:
                                    type: string
                                    description: A code to specify the type of charge.
                                    example: '1005'
                                  chargeTypeDescription:
                                    type: string
                                    description: Description of the charge type.
                                    example: Income Tax Estimate -  ITSA
                              amount:
                                type: number
                                description: |-
                                  The original value of this transaction.

                                  The value must be between -99999999999.99 and 99999999999.99 up to 2 decimal places.
                                example: '600.00'
                              clearedAmount:
                                type: number
                                description: |-
                                  The cleared value of this transaction.

                                  The value must be between -99999999999.99 and 99999999999.99 up to 2 decimal places.
                                example: '600.00'
                              contractAccount:
                                type: string
                                description: The accounting record for a particular charge type.
                                example: '000404772537'
                            required:
                              - chargeReference
                      required:
                        - allocations
                required:
                  - payments
              examples:
                Request:
                  value:
                    payments:
                      - paymentLot: '081203010024'
                        paymentLotItem: '000001'
                        paymentReference: '1594'
                        paymentAmount: 12345678912.02
                        paymentMethod: A
                        transactionDate: '2010-02-27'
                        allocations:
                          - chargeReference: XM002610011594
                            periodKey: 16RL
                            periodKeyDescription: 2016/17 month 12 RTI
                            startDate: '2010-03-27'
                            endDate: '2010-06-27'
                            dueDate: '2010-07-27'
                            chargeDetail:
                              documentId: '1040000872'
                              documentType: '1234'
                              documentTypeDescription: Income Tax Estimate
                              chargeType: '5678'
                              chargeTypeDescription: Income Tax Estimate - ITSA
                            amount: 12345678912.02
                            clearedAmount: 345678912.02
                            contractAccount: ABC
                          - chargeReference: XM002610011560
                            periodKey: 16RR
                            periodKeyDescription: 2016/17 month 10 RTI
                            startDate: '2010-04-21'
                            endDate: '2010-09-20'
                            dueDate: '2010-11-29'
                            chargeDetail:
                              documentId: '1040000872'
                              documentType: '1234'
                              documentTypeDescription: Income Tax Estimate
                              chargeType: '5678'
                              chargeTypeDescription: Income Tax Estimate - ITSA
                            amount: 12345678999.92
                            clearedAmount: 345678992.92
                            contractAccount: ABS
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied nino value is invalid.
                  value: *ref_14
                FORMAT_FROM_DATE:
                  description: |
                    The format of the fromDate is not valid.
                  value: *ref_21
                FORMAT_TO_DATE:
                  description: |
                    The format of toDate is not valid.
                  value: *ref_22
                RANGE_TO_DATE_BEFORE_FROM_DATE:
                  description: |
                    The To date must be after the From date.
                  value: *ref_23
                RULE_INVALID_DATE_RANGE:
                  description: |
                    The provided date range is not valid.
                  value: *ref_24
                MISSING_TO_DATE:
                  description: |
                    The To date parameter is missing.
                  value: *ref_25
                MISSING_FROM_DATE:
                  description: |
                    The From date parameter is missing
                  value: *ref_26
                RULE_INCONSISTENT_QUERY_PARAMS:
                  description: |
                    Provide either paymentLot & paymentLotItem or fromDate & toDate.
                  value:
                    code: RULE_INCONSISTENT_QUERY_PARAMS
                    message: Provide either paymentLot & paymentLotItem or fromDate & toDate.
                FORMAT_PAYMENT_LOT:
                  description: |
                    The format of the supplied paymentLot value is not valid.
                  value:
                    code: FORMAT_PAYMENT_LOT
                    message: The format of the supplied paymentLot value is not valid.
                FORMAT_PAYMENT_LOT_ITEM:
                  description: |
                    The format of the supplied paymentLotItem value is not valid.
                  value:
                    code: FORMAT_PAYMENT_LOT_ITEM
                    message: The format of the supplied paymentLotItem value is not valid.
                MISSING_PAYMENT_LOT:
                  description: |
                    The paymentLotItem value has been provided, but paymentLot value is missing.
                  value:
                    code: MISSING_PAYMENT_LOT
                    message: The paymentLotItem value has been provided, but paymentLot value is missing.
                MISSING_PAYMENT_LOT_ITEM:
                  description: |
                    The paymentLot value has been provided, but the paymentLotItem value is missing.
                  value:
                    code: MISSING_PAYMENT_LOT_ITEM
                    message: The paymentLot value has been provided, but the paymentLotItem value is missing.
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for 
                    this endpoint version. This error will only be returned in the Sandbox environment.
                  value: *ref_16
        '403':
          description: Forbidden
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    'The client or agent is not authorised. This is because: the client is not enrolled for MTD, the agent is not enrolled for Agent Services, the client has not authorised the agent to act on their behalf, or the Authorization token provided is not correct.'
                  value: *ref_17
        '404':
          description: Not found
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                NOT_FOUND:
                  description: |
                    Matching resource not found.
                  value: *ref_18
  /accounts/self-assessment/{nino}/{taxYear}/collection/tax-code:
    get:
      summary: Retrieve Coding Out Underpayments and Debt Amounts
      security:
        - User-Restricted:
            - read:self-assessment
      parameters:
        - $ref: ./common/queryParameters.yaml#/components/parameters/source
      description: |
        This endpoint enables you to retrieve HMRC-held coding out underpayments and debt amounts or user submitted amended coding out amounts for a previous tax year and given National Insurance number.

        ### Test data
        Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

        | Header Value (Gov-Test-Scenario)        | Scenario                                                    |
        |-----------------------------------------|-------------------------------------------------------------|
        | N/A - DEFAULT                           | Simulates a successful response with latest values.         |
        | N/A - DEFAULT<br>using ?source=latest   | Simulates a successful response with latest values.         |
        | N/A - DEFAULT<br>using ?source=hmrcHeld | Simulates a successful response with HMRC-held values.      |
        | N/A - DEFAULT<br>using ?source=user     | Simulates a successful response with user submitted values. |
        | NOT_FOUND                               | Simulates the scenario where no data is found.              |
        | STATEFUL                                | Performs a stateful retrieve. <p>Information and data held by HMRC is not available in the sandbox environment.<br> Providing â€˜source=hmrcHeldâ€™ will result in the expected HTTP 404 (matching resource not found) error being returned.</p> |
      tags:
        - Coding Out Underpayments and Debts
      responses:
        '200':
          description: Success
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                $schema: http://json-schema.org/draft-04/schema#
                title: Retrieve Coding Out underpayment and debt amounts
                description: Retrieve Coding Out underpayment and debt amounts
                type: object
                properties:
                  taxCodeComponents:
                    type: object
                    description: Object holding underpayment arrays.
                    properties:
                      selfAssessmentUnderpayment:
                        type: array
                        description: Array containing details of coded out Self Assessment underpayments.
                        minItems: 1
                        items:
                          type: object
                          properties:
                            id:
                              description: The ID for the Self Assessment underpayment.  It will only be returned after the tax year has ended.
                              type: number
                              multipleOf: 1
                              minimum: 1
                              maximum: 999999999999999
                              example: '1234567890'
                            amount:
                              description: The total coded out amount attributed to Self Assessment underpayments. The value must be between 0 and 99999999999.99 up to 2 decimal places.
                              type: number
                              multipleOf: 0.01
                              minimum: 0
                              maximum: 99999999999.99
                              example: '5000.99'
                            relatedTaxYear:
                              description: The tax year related to the underpayment.
                              type: string
                              example: 2021-22
                            submittedOn:
                              description: The date the coded out information was added. It is either the latest change date held within HMRC or the latest user submitted date. It is in the format YYYY-MM-DDThh:mm:ss.sssZ.
                              type: string
                              example: '2021-07-06T09:37:17.000Z'
                            source:
                              description: Specifies the source of data.
                              type: string
                              enum:
                                - hmrcHeld
                                - user
                          additionalProperties: false
                          required:
                            - amount
                            - source
                            - submittedOn
                      payeUnderpayment:
                        type: array
                        description: Array containing details of coded out PAYE underpayments.
                        minItems: 1
                        items:
                          type: object
                          properties:
                            id:
                              description: The ID for the PAYE underpayment.  It will only be returned after the tax year has ended.
                              type: number
                              multipleOf: 1
                              minimum: 1
                              maximum: 999999999999999
                              example: '1234567890'
                            amount:
                              description: The total coded out amount attributed to PAYE underpayments. The value must be between 0 and 99999999999.99 up to 2 decimal places.
                              type: number
                              multipleOf: 0.01
                              minimum: 0
                              maximum: 99999999999.99
                              example: '5000.99'
                            relatedTaxYear:
                              description: The tax year related to the underpayment.
                              type: string
                              example: 2021-22
                            submittedOn:
                              description: The date the coded out information was added. It is either the latest change date held within HMRC or the latest user submitted date. It is in the format YYYY-MM-DDThh:mm:ss.sssZ.
                              type: string
                              example: '2021-07-06T09:37:17.000Z'
                            source:
                              description: Specifies the source of data.
                              type: string
                              enum:
                                - hmrcHeld
                                - user
                          additionalProperties: false
                          required:
                            - amount
                            - source
                            - submittedOn
                      debt:
                        type: array
                        description: Array containing details of coded out debts.
                        minItems: 1
                        items:
                          type: object
                          properties:
                            id:
                              description: The ID for the coded out debts. It will only be returned after the tax year has ended.
                              type: number
                              multipleOf: 1
                              minimum: 1
                              maximum: 999999999999999
                              example: '1234567890'
                            amount:
                              description: The total amount of debt coded out. The value must be between 0 and 99999999999.99 up to 2 decimal places.
                              type: number
                              multipleOf: 0.01
                              minimum: 0
                              maximum: 99999999999.99
                              example: '5000.99'
                            relatedTaxYear:
                              description: The tax year related to the debt.
                              type: string
                              example: 2021-22
                            submittedOn:
                              description: The date the coded out information was added. It is either the latest change date held within HMRC or the latest user submitted date. It is in the format YYYY-MM-DDThh:mm:ss.sssZ.
                              type: string
                              example: '2021-07-06T09:37:17.000Z'
                            source:
                              description: Specifies the source of data.
                              type: string
                              enum:
                                - hmrcHeld
                                - user
                          additionalProperties: false
                          required:
                            - amount
                            - source
                            - submittedOn
                      inYearAdjustment:
                        type: object
                        description: Details of coded out in-year adjustments
                        properties:
                          id:
                            description: The ID for the HMRC classified debts. It will only be returned after the tax year has ended.
                            type: number
                            multipleOf: 1
                            minimum: 1
                            maximum: 999999999999999
                            example: '1234567890'
                          amount:
                            description: The total amount of PAYE coded out in-year adjustment. The value must be between 0 and 99999999999.99 up to 2 decimal places.
                            type: number
                            multipleOf: 0.01
                            minimum: 0
                            maximum: 99999999999.99
                            example: '5000.99'
                          relatedTaxYear:
                            description: The tax year related to the in-year adjustment.
                            type: string
                            example: 2021-22
                          submittedOn:
                            description: The date the coded out information was added. It is either the latest change date held within HMRC or the latest user submitted date. It is in the format YYYY-MM-DDThh:mm:ss.sssZ.
                            type: string
                            example: '2021-07-06T09:37:17.000Z'
                          source:
                            description: Specifies the source of data.
                            type: string
                            enum:
                              - hmrcHeld
                              - user
                        additionalProperties: false
                        required:
                          - amount
                          - source
                          - submittedOn
                    additionalProperties: false
                  unmatchedCustomerSubmissions:
                    type: object
                    description: Object holding underpayment arrays for unmatched customer submissions.
                    properties:
                      selfAssessmentUnderpayment:
                        type: array
                        description: Array containing details of coded out Self Assessment underpayments.
                        minItems: 1
                        items:
                          type: object
                          properties:
                            id:
                              description: The ID for the Self Assessment underpayment. It will only be returned after the tax year has ended.
                              type: number
                              multipleOf: 1
                              minimum: 1
                              maximum: 999999999999999
                              example: '1234567890'
                            amount:
                              description: The total coded out amount attributed to Self Assessment underpayments. The value must be between 0 and 99999999999.99 up to 2 decimal places.
                              type: number
                              multipleOf: 0.01
                              minimum: 0
                              maximum: 99999999999.99
                              example: '5000.99'
                            submittedOn:
                              description: The date the coded out information was added. It is either the latest change date held within HMRC or the latest user submitted date. It is in the format YYYY-MM-DDThh:mm:ss.sssZ.
                              type: string
                              example: '2021-07-06T09:37:17.000Z'
                          additionalProperties: false
                          required:
                            - amount
                            - submittedOn
                      payeUnderpayment:
                        type: array
                        description: Array containing details of coded out PAYE underpayments.
                        minItems: 1
                        items:
                          type: object
                          properties:
                            id:
                              description: The ID for the PAYE underpayment. It will only be returned after the tax year has ended.
                              type: number
                              multipleOf: 1
                              minimum: 1
                              maximum: 999999999999999
                              example: '1234567890'
                            amount:
                              description: The total coded out amount attributed to PAYE underpayments. The value must be between 0 and 99999999999.99 up to 2 decimal places.
                              type: number
                              multipleOf: 0.01
                              minimum: 0
                              maximum: 99999999999.99
                              example: '5000.99'
                            submittedOn:
                              description: The date the coded out information was added. It is either the latest change date held within HMRC or the latest user submitted date. It is in the format YYYY-MM-DDThh:mm:ss.sssZ.
                              type: string
                              example: '2021-07-06T09:37:17.000Z'
                          additionalProperties: false
                          required:
                            - amount
                            - submittedOn
                      debt:
                        type: array
                        description: Array containing details of coded out debts.
                        minItems: 1
                        items:
                          type: object
                          properties:
                            id:
                              description: The ID for the coded out debts. It will only be returned after the tax year has ended.
                              type: number
                              multipleOf: 1
                              minimum: 1
                              maximum: 999999999999999
                              example: '1234567890'
                            amount:
                              description: The total amount of debt coded out. The value must be between 0 and 99999999999.99 up to 2 decimal places.
                              type: number
                              multipleOf: 0.01
                              minimum: 0
                              maximum: 99999999999.99
                              example: '5000.99'
                            submittedOn:
                              description: The date the coded out information was added. It is either the latest change date held within HMRC or the latest user submitted date. It is in the format YYYY-MM-DDThh:mm:ss.sssZ.
                              type: string
                              example: '2021-07-06T09:37:17.000Z'
                          additionalProperties: false
                          required:
                            - amount
                            - submittedOn
                      inYearAdjustment:
                        type: object
                        description: Details of coded out in-year adjustments
                        properties:
                          id:
                            description: The ID for the HMRC classified debts. It will only be returned after the tax year has ended.
                            type: number
                            multipleOf: 1
                            minimum: 1
                            maximum: 999999999999999
                            example: '1234567890'
                          amount:
                            description: The total amount of PAYE coded out in-year adjustment. The value must be between 0 and 99999999999.99 up to 2 decimal places.
                            type: number
                            multipleOf: 0.01
                            minimum: 0
                            maximum: 99999999999.99
                            example: '5000.99'
                          submittedOn:
                            description: The date the coded out information was added. It is either the latest change date held within HMRC or the latest user submitted date. It is in the format YYYY-MM-DDThh:mm:ss.sssZ.
                            type: string
                            example: '2021-07-06T09:37:17.000Z'
                        additionalProperties: false
                        required:
                          - amount
                          - submittedOn
                    additionalProperties: false
              examples:
                Request:
                  value:
                    taxCodeComponents:
                      selfAssessmentUnderpayment:
                        - amount: 89.78
                          relatedTaxYear: 2021-22
                          submittedOn: '2021-07-06T09:37:17.000Z'
                          source: user
                          id: 1234567891
                      payeUnderpayment:
                        - amount: 14.45
                          relatedTaxYear: 2021-22
                          submittedOn: '2021-07-06T09:37:17.000Z'
                          source: user
                          id: 1234567891
                      debt:
                        - amount: 12.01
                          relatedTaxYear: 2021-22
                          submittedOn: '2021-07-06T09:37:17.000Z'
                          source: user
                          id: 1234567891
                      inYearAdjustment:
                        amount: 75.99
                        relatedTaxYear: 2021-22
                        submittedOn: '2021-07-06T09:37:17.000Z'
                        source: user
                        id: 1234567891
                    unmatchedCustomerSubmissions:
                      selfAssessmentUnderpayment:
                        - amount: 12.32
                          submittedOn: '2021-07-06T09:37:17.000Z'
                          id: 1234567891
                      payeUnderpayment:
                        - amount: 71.99
                          submittedOn: '2021-07-06T09:37:17.000Z'
                          id: 1234567891
                      debt:
                        - amount: 54.79
                          submittedOn: '2021-07-06T09:37:17.000Z'
                          id: 1234567891
                      inYearAdjustment:
                        amount: 56.74
                        submittedOn: '2021-07-06T09:37:17.000Z'
                        id: 1234567891
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied nino value is invalid.
                  value: *ref_14
                FORMAT_TAX_YEAR:
                  description: |
                    The format of the supplied taxYear value is invalid.
                  value: &ref_27
                    code: FORMAT_TAX_YEAR
                    message: The format of the supplied taxYear value is invalid.
                RULE_TAX_YEAR_NOT_SUPPORTED:
                  description: |
                    The specified tax year is not supported. That is, the tax year specified is before the minimum tax year value.
                  value: &ref_28
                    code: RULE_TAX_YEAR_NOT_SUPPORTED
                    message: The specified tax year is not supported. Either the tax year specified is before the minimum tax year value, or it is after the maximum tax year value.
                RULE_TAX_YEAR_RANGE_INVALID:
                  description: |
                    A taxYear range of one year is required.
                  value: &ref_29
                    code: RULE_TAX_YEAR_RANGE_INVALID
                    message: A taxYear range of one year is required.
                FORMAT_SOURCE:
                  description: |
                    The format of the supplied source is not valid.
                  value:
                    code: FORMAT_SOURCE
                    message: The format of the supplied source is not valid.
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for 
                    this endpoint version. This error will only be returned in the Sandbox environment.
                  value: *ref_16
        '403':
          description: Forbidden
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    'The client or agent is not authorised. This is because: the client is not enrolled for MTD, the agent is not enrolled for Agent Services, the client has not authorised the agent to act on their behalf, or the Authorization token provided is not correct.'
                  value: *ref_17
        '404':
          description: Not found
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                NOT_FOUND:
                  description: |
                    Matching resource not found.
                  value: *ref_18
                CODING_OUT_NOT_FOUND:
                  description: |
                    Coding out amounts could not be found for the supplied nino and taxYear.
                  value: &ref_33
                    code: MATCHING_RESOURCE_NOT_FOUND
                    message: Matching resource not found.
    put:
      summary: Create or Amend Coding Out Underpayments and Debt Amounts
      security:
        - User-Restricted:
            - write:self-assessment
      description: |
        This endpoint enables you to overwrite coding out underpayments and debt amounts held by HMRC for a previous tax year and given National Insurance number, and to amend previously submitted overwrite amounts. <strong>This endpoint can only be used after the tax year has ended.</strong>

        ### Test data
        Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

        | Header Value (Gov-Test-Scenario) | Scenario                                                                                        |
        |----------------------------------|-------------------------------------------------------------------------------------------------|
        | N/A - DEFAULT                    | Simulates success response.                                                                     |
        | DUPLICATE_ID_NOT_ALLOWED         | Simulates the scenario where the request data contains duplicate ID values.                     |
        | OUTSIDE_AMENDMENT_WINDOW         | Simulates the scenario where request cannot be completed as it is outside the amendment window. |
        | STATEFUL                         | Performs a stateful create or update.                                                           |
      tags:
        - Coding Out Underpayments and Debts
      parameters:
        - name: Accept
          in: header
          description: |
            Specifies the response format and the version of the API to be used.
          schema: *ref_8
          required: true
        - name: Content-Type
          in: header
          description: |
            Specifies the format of the request body, which must be JSON.
          schema:
            type: string
            enum:
              - application/json
          required: true
        - name: Authorization
          in: header
          description: |
            An OAuth 2.0 Bearer Token with the *write:self-assessment* scope.
          schema: &ref_31
            type: string
            example: Bearer bb7fed3fe10dd235a2ccda3d50fb
          required: true
        - name: Gov-Test-Scenario
          in: header
          description: |
            Only in sandbox environment. See Test Data table for all header values.
          schema: *ref_10
          required: false
        - name: nino
          in: path
          description: |
            National Insurance number, in the format `AA999999A`.
          schema: *ref_6
          required: true
        - name: taxYear
          in: path
          description: |
            The tax year the data applies to, for example, 2021-22. The start year and end year must not span two tax years. The minimum tax year is 2021-22. No gaps are allowed, for example, 2020-22 is not valid. (The minimum tax year in Sandbox is 2019-20.)
          schema: &ref_30
            type: string
            example: 2021-22
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $schema: http://json-schema.org/draft-04/schema#
              title: Create or Amend Coding Out underpayment and debt amounts
              description: Create or Amend Coding Out underpayment and debt amounts
              type: object
              properties:
                taxCodeComponents:
                  type: object
                  description: Object holding underpayment arrays.
                  properties:
                    payeUnderpayment:
                      type: array
                      description: Array containing details of coded out PAYE underpayments.
                      items:
                        type: object
                        properties:
                          id:
                            description: The identifier for the PAYE underpayments.
                            type: number
                            multipleOf: 1
                            minimum: 1
                            maximum: 999999999999999
                            example: '1234567890'
                          amount:
                            description: The total coded out amount attributed to PAYE underpayments. The value must be between 0 and 99999999999.99.
                            type: number
                            multipleOf: 0.01
                            minimum: 0
                            maximum: 99999999999.99
                            example: '1000.25'
                        additionalProperties: false
                        required:
                          - id
                          - amount
                      additionalItems: false
                    selfAssessmentUnderpayment:
                      type: array
                      description: Array containing details of coded out Self Assessment underpayments.
                      items:
                        type: object
                        properties:
                          id:
                            description: The identifier for the Self Assessment underpayments.
                            type: number
                            multipleOf: 1
                            minimum: 1
                            maximum: 999999999999999
                            example: '1234567890'
                          amount:
                            description: The total coded out amount attributed to Self Assessment underpayments. The value must be between 0 and 99999999999.99.
                            type: number
                            multipleOf: 0.01
                            minimum: 0
                            maximum: 99999999999.99
                            example: '1000.25'
                        additionalProperties: false
                        required:
                          - id
                          - amount
                      additionalItems: false
                    debt:
                      type: array
                      description: Array containing details of coded out debts.
                      items:
                        type: object
                        properties:
                          id:
                            description: The identifier for the HMRC classified debts.
                            type: number
                            multipleOf: 1
                            minimum: 1
                            maximum: 999999999999999
                            example: '1234567890'
                          amount:
                            description: The total coded out amount attributed to HMRC classified debts. The value must be between 0 and 99999999999.99.
                            type: number
                            multipleOf: 0.01
                            minimum: 0
                            maximum: 99999999999.99
                            example: '1000.25'
                        additionalProperties: false
                        required:
                          - id
                          - amount
                      additionalItems: false
                    inYearAdjustment:
                      type: object
                      description: Details of coded out in-year adjustments.
                      properties:
                        id:
                          description: The identifier for the total coded out amount attributed to in-year tax code adjustments to collect underpayments or debts.
                          type: number
                          multipleOf: 1
                          minimum: 1
                          maximum: 999999999999999
                          example: '1234567890'
                        amount:
                          description: The total coded out amount attributed to in-year tax code adjustments to collect underpayments or debts. The value must be between 0 and 99999999999.99.
                          type: number
                          multipleOf: 0.01
                          minimum: 0
                          maximum: 99999999999.99
                          example: '1000.25'
                      additionalProperties: false
                      required:
                        - id
                        - amount
                  additionalProperties: false
              required:
                - taxCodeComponents
              additionalProperties: false
            examples:
              example-1:
                description: Default Example
                value:
                  taxCodeComponents:
                    payeUnderpayment:
                      - amount: 2000.5
                        id: 1234567890
                    selfAssessmentUnderpayment:
                      - amount: 1123.45
                        id: 4657839807
                    debt:
                      - amount: 100.25
                        id: 2134693857
                    inYearAdjustment:
                      amount: 123.45
                      id: 9873562901
      responses:
        '204':
          description: Success(No Content)
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied nino value is invalid.
                  value: *ref_14
                FORMAT_TAX_YEAR:
                  description: |
                    The format of the supplied taxYear value is invalid.
                  value: *ref_27
                RULE_TAX_YEAR_NOT_SUPPORTED:
                  description: |
                    The specified tax year is not supported. That is, the tax year specified is before the minimum tax year value.
                  value: *ref_28
                RULE_TAX_YEAR_RANGE_INVALID:
                  description: |
                    A taxYear range of one year is required.
                  value: *ref_29
                RULE_TAX_YEAR_NOT_ENDED:
                  description: |
                    The submission has been made before the taxYear it relates to has ended.
                  value:
                    code: RULE_TAX_YEAR_NOT_ENDED
                    message: The submission has been made before the taxYear it relates to has ended.
                RULE_DUPLICATE_ID_NOT_ALLOWED:
                  description: |
                    The request data contains duplicate ID values.
                  value:
                    code: RULE_DUPLICATE_ID_NOT_ALLOWED
                    message: The request data contains duplicate ID values.
                FORMAT_VALUE:
                  description: |
                    One or more values have been added with the incorrect format.
                  value:
                    code: FORMAT_VALUE
                    message: One or more values have been added with the incorrect format.
                FORMAT_ID:
                  description: |
                    The format of the supplied ID is invalid.
                  value:
                    code: FORMAT_ID
                    message: The format of the supplied ID is invalid.
                RULE_INCORRECT_OR_EMPTY_BODY_SUBMITTED:
                  description: |
                    An empty or non-matching body was submitted.
                  value:
                    code: RULE_INCORRECT_OR_EMPTY_BODY_SUBMITTED
                    message: An empty or non-matching body was submitted.
                RULE_OUTSIDE_AMENDMENT_WINDOW:
                  description: The request cannot be completed as you are outside the amendment window.
                  value: &ref_32
                    code: RULE_OUTSIDE_AMENDMENT_WINDOW
                    message: You are outside the amendment window
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for 
                    this endpoint version. This error will only be returned in the Sandbox environment.
                  value: *ref_16
        '403':
          description: Forbidden
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    'The client or agent is not authorised. This is because: the client is not enrolled for MTD, the agent is not enrolled for Agent Services, the client has not authorised the agent to act on their behalf, or the Authorization token provided is not correct.'
                  value: *ref_17
    delete:
      summary: Delete Coding Out Underpayments and Debt Amounts
      security:
        - User-Restricted:
            - write:self-assessment
      description: |
        This endpoint enables you to delete custom coding out amounts for a given tax year and National Insurance number.

        ### Test data
        Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

        | Header Value (Gov-Test-Scenario) | Scenario                                                                                        |
        |----------------------------------|-------------------------------------------------------------------------------------------------|
        | N/A - DEFAULT                    | Simulates success response.                                                                     |
        | OUTSIDE_AMENDMENT_WINDOW         | Simulates the scenario where request cannot be completed as it is outside the amendment window. |
        | NOT_FOUND                        | Simulates the scenario where no data is found.                                                  |
        | STATEFUL                         | Performs a stateful delete.                                                                     |
      tags:
        - Coding Out Underpayments and Debts
      parameters:
        - name: nino
          in: path
          description: |
            National Insurance number, in the format `AA999999A`.
          schema: *ref_6
          required: true
        - name: taxYear
          in: path
          description: |
            The tax year the data applies to, for example, 2021-22. The start year and end year must not span two tax years. The minimum tax year is 2021-22. No gaps are allowed, for example, 2020-22 is not valid. (The minimum tax year in Sandbox is 2019-20.)
          schema: *ref_30
          required: true
        - name: Accept
          in: header
          description: |
            Specifies the response format and the version of the API to be used.
          schema: *ref_8
          required: true
        - name: Authorization
          in: header
          description: |
            An OAuth 2.0 Bearer Token with the *write:self-assessment* scope.
          schema: *ref_31
          required: true
        - name: Gov-Test-Scenario
          in: header
          description: |
            Only in sandbox environment. See Test Data table for all header values.
          schema: *ref_10
          required: false
      responses:
        '204':
          description: (No content)
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied nino value is invalid.
                  value: *ref_14
                FORMAT_TAX_YEAR:
                  description: |
                    The format of the supplied taxYear value is invalid.
                  value: *ref_27
                RULE_TAX_YEAR_NOT_SUPPORTED:
                  description: |
                    The specified tax year is not supported. That is, the tax year specified is before the minimum tax year value.
                  value: *ref_28
                RULE_TAX_YEAR_RANGE_INVALID:
                  description: |
                    A taxYear range of one year is required.
                  value: *ref_29
                RULE_OUTSIDE_AMENDMENT_WINDOW:
                  description: The request cannot be completed as you are outside the amendment window.
                  value: *ref_32
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for 
                    this endpoint version. This error will only be returned in the Sandbox environment.
                  value: *ref_16
        '403':
          description: Forbidden
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    'The client or agent is not authorised. This is because: the client is not enrolled for MTD, the agent is not enrolled for Agent Services, the client has not authorised the agent to act on their behalf, or the Authorization token provided is not correct.'
                  value: *ref_17
        '404':
          description: Not found
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CODING_OUT_NOT_FOUND:
                  description: |
                    Coding out amounts could not be found for the supplied nino and taxYear.
                  value: *ref_33
  /accounts/self-assessment/{nino}/{taxYear}/collection/tax-code/coding-out/opt-out:
    post:
      summary: Opt Out of Coding Out
      description: |
        This endpoint enables a specified customer (identified by a National Insurance number) and tax year to opt out of coding out. Opt-out status can be changed up to and including 30 December following the end of the specified tax year. Opt-out status cannot be changed after the customer has made a final declaration for the specified tax year.
            
        ### Test data
        Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

        | Header Value (Gov-Test-Scenario) | Scenario                                                                                                                                                 |
        |----------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
        | N/A - DEFAULT                    | Simulates a successful response with latest values.                                                                                                      |
        | BUSINESS_PARTNER_NOT_EXIST       | Simulates a scenario where the NINO is valid but is not registered with ITSD as a business partner.                                                      |
        | ITSA_CONTRACT_OBJECT_NOT_EXIST   | Simulates a scenario where the NINO is valid and is registered with ITSD as a business partner, but the ITSA contract object does not exist for the NINO.|
        | ALREADY_OPTED_OUT                | Simulates a scenario where the customer cannot be opted out because they are already opted out.                                                          |
        | STATEFUL                         | Performs a stateful Opt Out of Coding Out.                                                                                                               |
      security:
        - User-Restricted:
            - read:self-assessment
      tags:
        - Coding Out Status
      parameters:
        - name: Accept
          in: header
          description: |
            Specifies the response format and the version of the API to be used.
          schema: *ref_8
          required: true
        - name: Authorization
          in: header
          description: |
            An OAuth 2.0 Bearer Token with the *read:self-assessment* scope.
          schema: *ref_9
          required: true
        - name: Gov-Test-Scenario
          in: header
          description: |
            Only in sandbox environment. See Test Data table for all header values.
          schema: *ref_10
          required: false
        - name: nino
          in: path
          description: |
            National Insurance number, in the format `AA999999A`.
          schema: *ref_6
          required: true
        - name: taxYear
          in: path
          description: |
            The tax year the data applies to, for example, 2021-22. The start year and end year must not span two tax years. No gaps are allowed, for example, 2020-22 is not valid.
          schema: &ref_34
            type: string
            example: 2021-22
          required: true
      responses:
        '204':
          description: Success(No Content)
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied nino value is invalid.
                  value: *ref_14
                FORMAT_TAX_YEAR:
                  description: |
                    The format of the supplied taxYear value is invalid.
                  value: *ref_27
                RULE_BUSINESS_PARTNER_NOT_EXIST:
                  description: |
                    The remote endpoint has indicated that business partner does not exist for NINO.
                  value: &ref_35
                    code: RULE_BUSINESS_PARTNER_NOT_EXIST
                    message: Provided NINO is not registered as business partner.
                RULE_ITSA_CONTRACT_OBJECT_NOT_EXIST:
                  description: |
                    The remote endpoint has indicated that ITSA contract object does not exist.
                  value: &ref_36
                    code: RULE_ITSA_CONTRACT_OBJECT_NOT_EXIST
                    message: ITSA contract object does not exist.
                RULE_ALREADY_OPTED_OUT:
                  description: |
                    The opt-out indicator cannot be set to the same value it currently holds.
                  value:
                    code: RULE_ALREADY_OPTED_OUT
                    message: Customer is already opted out of coding out
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for 
                    this endpoint version. This error will only be returned in the Sandbox environment.
                  value: *ref_16
        '403':
          description: Forbidden
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    'The client or agent is not authorised. This is because: the client is not enrolled for MTD, the agent is not enrolled for Agent Services, the client has not authorised the agent to act on their behalf, or the Authorization token provided is not correct.'
                  value: *ref_17
  /accounts/self-assessment/{nino}/{taxYear}/collection/tax-code/coding-out/status:
    get:
      summary: Retrieve Coding Out Status
      description: |
        This endpoint enables you to retrieve opt-out of coding out status for a specified customer (identified by a National Insurance number) and tax year.

        ### Test data
        Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

        | Header Value (Gov-Test-Scenario)        | Scenario                                                           |
        |-----------------------------------------|--------------------------------------------------------------------|
        | N/A - DEFAULT                           | Simulates a successful response with latest values.                |
        | BUSINESS_PARTNER_NOT_EXIST              | Simulates a scenario where the business partner does not exist.    |
        | ITSA_CONTRACT_OBJECT_NOT_EXIST          | Simulates a scenario where the ITSA contract object does not exist.|
        | STATEFUL                                | Performs a stateful Retrieve Coding Out Status.                    |
      security:
        - User-Restricted:
            - read:self-assessment
      tags:
        - Coding Out Status
      parameters:
        - name: Accept
          in: header
          description: |
            Specifies the response format and the version of the API to be used.
          schema: *ref_8
          required: true
        - name: Authorization
          in: header
          description: |
            An OAuth 2.0 Bearer Token with the *read:self-assessment* scope.
          schema: *ref_9
          required: true
        - name: Gov-Test-Scenario
          in: header
          description: |
            Only in sandbox environment. See Test Data table for all header values.
          schema: *ref_10
          required: false
        - name: nino
          in: path
          description: |
            National Insurance number, in the format `AA999999A`.
          schema: *ref_6
          required: true
        - name: taxYear
          in: path
          description: |
            The tax year the data applies to, for example, 2021-22. The start year and end year must not span two tax years. No gaps are allowed, for example, 2020-22 is not valid.
          schema: *ref_34
          required: true
      responses:
        '200':
          description: Success
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                type: object
                properties:
                  processingDate:
                    type: string
                    format: date-time
                    description: The date and time that the request was processed in the system.
                  nino:
                    type: string
                    description: National Insurance number, in the format AA999999A.
                  taxYear:
                    type: string
                    description: The tax year the data applies to, for example 2021-22. The start year and end year must not span two tax years. The minimum tax year is 2021-22. No gaps are allowed, for example, 2020-22 is not valid. (The minimum tax year in Sandbox is 2019-20.).
                    pattern: ^2[0-9]{3}-[0-9]{2}$
                  optOutIndicator:
                    type: boolean
                    description: |-
                      Indicates the coding out status of the tax year.
                      - true: Customer opted out of coding out for the tax year
                      - false: Customer opted in to coding out for the tax year
                required:
                  - processingDate
                  - nino
                  - taxYear
                  - optOutIndicator
                additionalProperties: false
              examples:
                Request:
                  value:
                    processingDate: '2020-12-17T09:30:47Z'
                    nino: AB123456A
                    taxYear: 2020-21
                    optOutIndicator: true
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied nino value is invalid.
                  value: *ref_14
                FORMAT_TAX_YEAR:
                  description: |
                    The format of the supplied taxYear value is invalid.
                  value: *ref_27
                RULE_TAX_YEAR_NOT_SUPPORTED:
                  description: |
                    The specified tax year is not supported. That is, the tax year specified is before the minimum tax year value.
                  value: *ref_28
                RULE_TAX_YEAR_RANGE_INVALID:
                  description: |
                    A taxYear range of one year is required.
                  value: *ref_29
                RULE_BUSINESS_PARTNER_NOT_EXIST:
                  description: |
                    The remote endpoint has indicated that business partner does not exist for NINO.
                  value: *ref_35
                RULE_ITSA_CONTRACT_OBJECT_NOT_EXIST:
                  description: |
                    The remote endpoint has indicated that ITSA contract object does not exist.
                  value: *ref_36
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for 
                    this endpoint version. This error will only be returned in the Sandbox environment.
                  value: *ref_16
  /accounts/self-assessment/{nino}/{taxYear}/collection/tax-code/coding-out/opt-in:
    post:
      summary: Opt In to Coding Out
      description: |
        This endpoint enables a specified customer (identified by a National Insurance number) and tax year to opt in to coding out.

        ### Test data
        Scenario simulation using Gov-Test-Scenario headers is only available in the sandbox environment.

        | Header Value (Gov-Test-Scenario) | Scenario                                                                                                                                                 |
        |----------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
        | N/A - DEFAULT                    | Simulates a successful response with latest values.                                                                                                      |
        | BUSINESS_PARTNER_NOT_EXIST       | Simulates a scenario where the NINO is valid but is not registered with ITSD as a business partner.                                                      |
        | ITSA_CONTRACT_OBJECT_NOT_EXIST   | Simulates a scenario where the NINO is valid and is registered with ITSD as a business partner, but the ITSA contract object does not exist for the NINO.|
        | ALREADY_OPTED_IN                 | Simulates a scenario where the customer cannot be opted in because they are already opted in.                                                            |
        | STATEFUL                         | Performs a stateful Opt In to Coding Out.                                                                                                                |
      security:
        - User-Restricted:
            - read:self-assessment
      tags:
        - Coding Out Status
      parameters:
        - name: Accept
          in: header
          description: |
            Specifies the response format and the version of the API to be used.
          schema: *ref_8
          required: true
        - name: Authorization
          in: header
          description: |
            An OAuth 2.0 Bearer Token with the *read:self-assessment* scope.
          schema: *ref_9
          required: true
        - name: Gov-Test-Scenario
          in: header
          description: |
            Only in sandbox environment. See Test Data table for all header values.
          schema: *ref_10
          required: false
        - name: nino
          in: path
          description: |
            National Insurance number, in the format `AA999999A`.
          schema: *ref_6
          required: true
        - name: taxYear
          in: path
          description: |
            The tax year the data applies to, for example, 2021-22. The start year and end year must not span two tax years. No gaps are allowed, for example, 2020-22 is not valid.
          schema: *ref_34
          required: true
      responses:
        '204':
          description: Success(No Content)
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
        '400':
          description: Bad request
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                FORMAT_NINO:
                  description: |
                    The format of the supplied nino value is invalid.
                  value: *ref_14
                FORMAT_TAX_YEAR:
                  description: |
                    The format of the supplied taxYear value is invalid.
                  value: *ref_27
                RULE_BUSINESS_PARTNER_NOT_EXIST:
                  description: |
                    The remote endpoint has indicated that business partner does not exist for NINO.
                  value: *ref_35
                RULE_ITSA_CONTRACT_OBJECT_NOT_EXIST:
                  description: |
                    The remote endpoint has indicated that ITSA contract object does not exist.
                  value: *ref_36
                RULE_ALREADY_OPTED_IN:
                  description: |
                    The remote endpoint has indicated that customer is already opted in to coding out.
                  value:
                    code: RULE_ALREADY_OPTED_IN
                    message: Customer is already opted in to coding out
                RULE_INCORRECT_GOV_TEST_SCENARIO:
                  description: |
                    The request did not match any available Sandbox data. Check that the supplied Gov-Test-Scenario is correct for 
                    this endpoint version. This error will only be returned in the Sandbox environment.
                  value: *ref_16
        '403':
          description: Forbidden
          headers:
            X-CorrelationId:
              in: header
              type: string
              description: |
                Unique ID for operation tracking
                String, 36 characters.
              schema: *ref_0
              required: true
            Deprecation:
              name: Deprecation
              in: header
              description: |
                The deprecation date/time for this endpoint.
              schema: *ref_1
              required: false
            Sunset:
              name: Sunset
              in: header
              description: |
                The earliest date/time this endpoint will become unavailable after deprecation.
              schema: *ref_2
              required: false
            Link:
              name: Link
              in: header
              description: |
                URL of the documentation for the API.
              schema: *ref_3
              required: false
          content:
            application/json:
              schema:
                description: Error Response
                type: object
                properties: *ref_4
                required: *ref_5
              examples:
                CLIENT_OR_AGENT_NOT_AUTHORISED:
                  description: |
                    'The client or agent is not authorised. This is because: the client is not enrolled for MTD, the agent is not enrolled for Agent Services, the client has not authorised the agent to act on their behalf, or the Authorization token provided is not correct.'
                  value: *ref_17
components:
  securitySchemes:
    User-Restricted:
      type: oauth2
      description: HMRC supports OAuth 2.0 for authenticating [User-restricted](https://developer.service.hmrc.gov.uk/api-documentation/docs/authorisation/user-restricted-endpoints) API requests
      flows:
        authorizationCode:
          authorizationUrl: https://api.service.hmrc.gov.uk/oauth/authorize
          tokenUrl: https://api.service.hmrc.gov.uk/oauth/token
          refreshUrl: https://api.service.hmrc.gov.uk/oauth/refresh
          scopes:
            write:self-assessment: Grant write access
            read:self-assessment: Grant read access
